"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[487],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>d});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},m="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),m=p(n),c=o,d=m["".concat(l,".").concat(c)]||m[c]||h[c]||r;return n?a.createElement(d,i(i({ref:t},u),{},{components:n})):a.createElement(d,i({ref:t},u))}));function d(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=c;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[m]="string"==typeof e?e:o,i[1]=s;for(var p=2;p<r;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},3414:(e,t,n)=>{n.d(t,{Z:()=>i});var a=n(7294),o=n(941),r=n(4996);const i=e=>{let{alt:t,sources:n}=e;const[i,s]=(0,a.useState)(!1),l=e=>{"Escape"===e.key&&s(!1)};return(0,a.useEffect)((()=>(i?document.addEventListener("keydown",l):document.removeEventListener("keydown",l),()=>{document.removeEventListener("keydown",l)})),[i]),a.createElement("div",{className:"zoomable-image "+(i?"fullscreen":""),onClick:()=>{s(!i)}},a.createElement(o.Z,{className:"zoomable-image-inner",alt:t,sources:{light:(0,r.Z)(n.light),dark:(0,r.Z)(n.dark)}}))}},7307:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>p});var a=n(7462),o=(n(7294),n(3905));n(941),n(4996),n(3414);const r={},i="Chains",s={unversionedId:"components/chains",id:"components/chains",title:"Chains",description:"Chains, in the context of language models, refer to a series of calls made to a language model. It allows for the output of one call to be used as the input for another call. Different types of chains allow for different levels of complexity. Chains are useful for creating pipelines and executing specific scenarios.",source:"@site/docs/components/chains.mdx",sourceDirName:"components",slug:"/components/chains",permalink:"/components/chains",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"docs",previous:{title:"Agents",permalink:"/components/agents"},next:{title:"Embeddings",permalink:"/components/embeddings"}},l={},p=[{value:"CombineDocsChain",id:"combinedocschain",level:3},{value:"ConversationChain",id:"conversationchain",level:3},{value:"ConversationalRetrievalChain",id:"conversationalretrievalchain",level:3},{value:"LLMChain",id:"llmchain",level:3},{value:"LLMMathChain",id:"llmmathchain",level:3},{value:"RetrievalQA",id:"retrievalqa",level:3},{value:"SQLDatabaseChain",id:"sqldatabasechain",level:3}],u={toc:p},m="wrapper";function h(e){let{components:t,...n}=e;return(0,o.kt)(m,(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"chains"},"Chains"),(0,o.kt)("p",null,"Chains, in the context of language models, refer to a series of calls made to a language model. It allows for the output of one call to be used as the input for another call. Different types of chains allow for different levels of complexity. Chains are useful for creating pipelines and executing specific scenarios."),(0,o.kt)("hr",null),(0,o.kt)("h3",{id:"combinedocschain"},"CombineDocsChain"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"CombineDocsChain")," incorporates methods to combine or aggregate loaded documents for question-answering functionality."),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"Works as a proxy of LangChain\u2019s ",(0,o.kt)("a",{parentName:"p",href:"https://python.langchain.com/docs/modules/chains/document/"},"documents")," chains generated by the ",(0,o.kt)("inlineCode",{parentName:"p"},"load_qa_chain")," function.")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Params")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"LLM:")," Language Model to use in the chain.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"chain_type:")," The chain type to be used. Each one of them applies a different \u201ccombination strategy\u201d."),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"stuff"),": The stuff ",(0,o.kt)("a",{parentName:"p",href:"https://python.langchain.com/docs/modules/chains/document/stuff"},"documents"),' chain (\u201cstuff" as in "to stuff" or "to fill") is the most straightforward of ',(0,o.kt)("em",{parentName:"p"},"the")," document chains. It takes a list of documents, inserts them all into a prompt, and passes that prompt to an LLM. This chain is well-suited for applications where documents are small and only a few are passed in for most calls.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"map_reduce"),": The map-reduce ",(0,o.kt)("a",{parentName:"p",href:"https://python.langchain.com/docs/modules/chains/document/map_reduce"},"documents")," chain first applies an LLM chain to each document individually (the Map step), treating the chain output as a new document. It then passes all the new documents to a separate combined documents chain to get a single output (the Reduce step). It can optionally first compress or collapse the mapped documents to make sure that they fit in the combined documents chain (which will often pass them to an LLM). This compression step is performed recursively if necessary.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"map_rerank"),": The map re-rank ",(0,o.kt)("a",{parentName:"p",href:"https://python.langchain.com/docs/modules/chains/document/map_rerank"},"documents")," chain runs an initial prompt on each document that not only tries to complete a task but also gives a score for how certain it is in its answer. The highest-scoring response is returned.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"refine"),": The refine ",(0,o.kt)("a",{parentName:"p",href:"https://python.langchain.com/docs/modules/chains/document/refine"},"documents")," chain constructs a response by looping over the input documents and iteratively updating its answer. For each document, it passes all non-document inputs, the current document, and the latest intermediate answer to an LLM chain to get a new answer."),(0,o.kt)("p",{parentName:"li"}," Since the Refine chain only passes a single document to the LLM at a time, it is well-suited for tasks that require analyzing more documents than can fit in the model's context. The obvious tradeoff is that this chain will make far more LLM calls than, for example, the Stuff documents chain. There are also certain tasks that are difficult to accomplish iteratively. For example, the Refine chain can perform poorly when documents frequently cross-reference one another or when a task requires detailed information from many documents."))))),(0,o.kt)("hr",null),(0,o.kt)("h3",{id:"conversationchain"},"ConversationChain"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"ConversationChain")," is a straightforward chain for interactive conversations with a language model, making it ideal for chatbots or virtual assistants. It allows for dynamic conversations, question-answering, and complex dialogues."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Params")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"LLM:")," Language Model to use in the chain."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Memory:")," Default memory store."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"input_key:")," Used to specify the key under which the user input will be stored in the conversation memory. It allows you to provide the user's input to the chain for processing and generating a response."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"output_key:")," Used to specify the key under which the generated response will be stored in the conversation memory. It allows you to retrieve the response using the specified key."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"verbose:"),"  This parameter is used to control the level of detail in the output of the chain. When set to True, it will print out some internal states of the chain while it is being run, which can be helpful for debugging and understanding the chain's behavior. If set to False, it will suppress the verbose output \u2014 defaults to ",(0,o.kt)("inlineCode",{parentName:"li"},"False"),".")),(0,o.kt)("hr",null),(0,o.kt)("h3",{id:"conversationalretrievalchain"},"ConversationalRetrievalChain"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"ConversationalRetrievalChain")," extracts information and provides answers by combining document search and question-answering abilities."),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"A retriever is a component that finds documents based on a query. It doesn't store the documents themselves, but it returns the ones that match the query.")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Params")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"LLM:")," Language Model to use in the chain.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"Memory:")," Default memory store.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"Retriever:")," The retriever used to fetch relevant documents.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"chain_type:")," The chain type to be used. Each one of them applies a different \u201ccombination strategy\u201d."),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"stuff"),": The stuff ",(0,o.kt)("a",{parentName:"p",href:"https://python.langchain.com/docs/modules/chains/document/stuff"},"documents"),' chain (\u201cstuff" as in "to stuff" or "to fill") is the most straightforward of ',(0,o.kt)("em",{parentName:"p"},"the")," document chains. It takes a list of documents, inserts them all into a prompt, and passes that prompt to an LLM. This chain is well-suited for applications where documents are small and only a few are passed in for most calls.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"map_reduce"),": The map-reduce ",(0,o.kt)("a",{parentName:"p",href:"https://python.langchain.com/docs/modules/chains/document/map_reduce"},"documents")," chain first applies an LLM chain to each document individually (the Map step), treating the chain output as a new document. It then passes all the new documents to a separate combined documents chain to get a single output (the Reduce step). It can optionally first compress or collapse the mapped documents to make sure that they fit in the combined documents chain (which will often pass them to an LLM). This compression step is performed recursively if necessary.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"map_rerank"),": The map re-rank ",(0,o.kt)("a",{parentName:"p",href:"https://python.langchain.com/docs/modules/chains/document/map_rerank"},"documents")," chain runs an initial prompt on each document that not only tries to complete a task but also gives a score for how certain it is in its answer. The highest-scoring response is returned.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"refine"),": The refine ",(0,o.kt)("a",{parentName:"p",href:"https://python.langchain.com/docs/modules/chains/document/refine"},"documents")," chain constructs a response by looping over the input documents and iteratively updating its answer. For each document, it passes all non-document inputs, the current document, and the latest intermediate answer to an LLM chain to get a new answer."),(0,o.kt)("p",{parentName:"li"}," Since the Refine chain only passes a single document to the LLM at a time, it is well-suited for tasks that require analyzing more documents than can fit in the model's context. The obvious tradeoff is that this chain will make far more LLM calls than, for example, the Stuff documents chain. There are also certain tasks that are difficult to accomplish iteratively. For example, the Refine chain can perform poorly when documents frequently cross-reference one another or when a task requires detailed information from many documents.")))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"return_source_documents:")," Used to specify whether or not to include the source documents that were used to answer the question in the output. When set to ",(0,o.kt)("inlineCode",{parentName:"p"},"True"),", source documents will be included in the output along with the generated answer. This can be useful for providing additional context or references to the user \u2014 defaults to ",(0,o.kt)("inlineCode",{parentName:"p"},"True"),".")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"verbose:")," Whether or not to run in verbose mode. In verbose mode, intermediate logs will be printed to the console \u2014 defaults to ",(0,o.kt)("inlineCode",{parentName:"p"},"False"),"."))),(0,o.kt)("hr",null),(0,o.kt)("h3",{id:"llmchain"},"LLMChain"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"LLMChain")," is a straightforward chain that adds functionality around language models. It combines a prompt template with a language model. To use it, create input variables to format the prompt template. The formatted prompt is then sent to the language model, and the generated output is returned as the result of the ",(0,o.kt)("inlineCode",{parentName:"p"},"LLMChain"),"."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Params")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"LLM:")," Language Model to use in the chain."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Memory:")," Default memory store."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Prompt"),": Prompt template object to use in the chain."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"output_key:")," This parameter is used to specify which key in the LLM output dictionary should be returned as the final output. By default, the ",(0,o.kt)("inlineCode",{parentName:"li"},"LLMChain")," returns both the input and output key values \u2014 defaults to ",(0,o.kt)("inlineCode",{parentName:"li"},"text"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"verbose:")," Whether or not to run in verbose mode. In verbose mode, intermediate logs will be printed to the console \u2014 defaults to ",(0,o.kt)("inlineCode",{parentName:"li"},"False"),".")),(0,o.kt)("hr",null),(0,o.kt)("h3",{id:"llmmathchain"},"LLMMathChain"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"LLMMathChain")," combines a language model (LLM) and a math calculation component. It allows the user to input math problems and get the corresponding solutions."),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"LLMMathChain")," works by using the language model with an ",(0,o.kt)("inlineCode",{parentName:"p"},"LLMChain")," to understand the input math problem and generate a math expression. It then passes this expression to the math component, which evaluates it and returns the result."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Params")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"LLM:")," Language Model to use in the chain."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"LLMChain:")," LLM Chain to use in the chain."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Memory:")," Default memory store."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"input_key:")," Used to specify the input value for the mathematical calculation. It allows you to provide the specific values or variables that you want to use in the calculation \u2014 defaults to ",(0,o.kt)("inlineCode",{parentName:"li"},"question"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"output_key:")," Used to specify the key under which the output of the mathematical calculation will be stored. It allows you to retrieve the result of the calculation using the specified key \u2014 defaults to ",(0,o.kt)("inlineCode",{parentName:"li"},"answer"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"verbose:")," Whether or not to run in verbose mode. In verbose mode, intermediate logs will be printed to the console \u2014 defaults to ",(0,o.kt)("inlineCode",{parentName:"li"},"False"),".")),(0,o.kt)("hr",null),(0,o.kt)("h3",{id:"retrievalqa"},"RetrievalQA"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"RetrievalQA")," is a chain used to find relevant documents or information to answer a given query. The retriever is responsible for returning the relevant documents based on the query, and the QA component then extracts the answer from those documents. The retrieval QA system combines the capabilities of both the retriever and the QA component to provide accurate and relevant answers to user queries."),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"A retriever is a component that finds documents based on a query. It doesn't store the documents themselves, but it returns the ones that match the query.")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Params")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Combine Documents Chain:")," Chain to use to combine the documents."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Memory:")," Default memory store."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Retriever:"),"  The retriever used to fetch relevant documents."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"input_key:")," This parameter is used to specify the key in the input data that contains the question. It is used to retrieve the question from the input data and pass it to the question-answering model for generating the answer \u2014 defaults to ",(0,o.kt)("inlineCode",{parentName:"li"},"query"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"output_key:")," This parameter is used to specify the key in the output data where the generated answer will be stored. It is used to retrieve the answer from the output data after the question-answering model has generated it \u2014 defaults to ",(0,o.kt)("inlineCode",{parentName:"li"},"result"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"return_source_documents:")," Used to specify whether or not to include the source documents that were used to answer the question in the output. When set to ",(0,o.kt)("inlineCode",{parentName:"li"},"True"),", source documents will be included in the output along with the generated answer. This can be useful for providing additional context or references to the user \u2014 defaults to ",(0,o.kt)("inlineCode",{parentName:"li"},"True"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"verbose:")," Whether or not to run in verbose mode. In verbose mode, intermediate logs will be printed to the console \u2014 defaults to ",(0,o.kt)("inlineCode",{parentName:"li"},"False"),".")),(0,o.kt)("hr",null),(0,o.kt)("h3",{id:"sqldatabasechain"},"SQLDatabaseChain"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"SQLDatabaseChain")," finds answers to questions using a SQL database. It works by using the language model to understand the SQL query and generate the corresponding SQL code. It then passes the SQL code to the SQL database component, which executes the query on the database and returns the result."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Params")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Db:")," SQL Database to connect to."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"LLM:")," Language Model to use in the chain."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Prompt:")," Prompt template to translate natural language to SQL.")))}h.isMDXComponent=!0}}]);